<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MVVM - Todo List</title>
    <link rel="stylesheet" href="lib/index.css">
</head>
<body>
    <div id="root">
        <h2><a href="https://github.com/shalldie/mvvm" target="_blank" style="color: #2ad;">MVVM</a> - Todo List</h2>
        <div class="input-box">
            <input x-model="content" type="text" placeholder="Enter plan to save.">
            <button @click="addItem" type="button">Add</button>
        </div>
        <div class="list-tab">
            <div
                @click="changeFilter(index)"
                x-for="(item,index) in filters"
                :class="getTabClass(index,filterIndex)"
            >{{item}}</div>
            <div class="tab">
                <button @click="reset" type="button">é‡ç½®æ‰€æœ‰</button>
            </div>
        </div>
        <ul class="item-list">
            <li x-for="(item,index) in list" :class="getListItemClass(item)">
                <div @click="toggleDone(item)" class="text">{{item.content}}</div>
                <div @click="deleteItem(item)" class="del">Del</div>
            </li>
        </ul>
    </div>
	<script src="https://cdn.jsdelivr.net/npm/babel-polyfill@6.26.0/dist/polyfill.min.js"></script>
    <script src="lib/mvvm.js"></script>
    <script>
        new MVVM({
            el: '#root',
            data: function () {
                return {
                    content: '',
                    infos: [
                        { content: 'ä¸­ä¸€æ¬¡åŒè‰²çƒï¼Œåæ³¨çš„ >_<#@!', done: false },
                        { content: 'ç„¶åå†ä¸­ä¸€æ¬¡ä½“å½©ï¼Œè¿˜æ˜¯åæ³¨çš„ 0_o', done: false },
                        { content: 'æˆ‘å…¨éƒ½è¦ ğŸ˜‚ ğŸŒš ğŸ¤£ ğŸ’… ğŸ‘… ğŸ¤  ', done: false }
                    ],
                    filters: ['All', 'Todos', 'Dones'],
                    filterIndex: 0
                };
            },
            computed: {
                // å½“å‰tabå¯¹åº”çš„æ•°æ®
                list: function () {
                    var filterIndex = this.filterIndex;
                    var list = this.infos;

                    if (filterIndex === 0) {
                        return list;
                    }
                    else if (filterIndex === 1) {
                        return list.filter(function (item) {
                            return !item.done;
                        });
                    }
                    else {
                        return list.filter(function (item) {
                            return item.done;
                        });
                    }
                }
            },
            created: function () {
                this.restore();
            },
            methods: {
                // è·å–tabçš„class
                getTabClass: function (index) {
                    return index === this.filterIndex ? 'tab active' : 'tab';
                },
                // è·å–listItemçš„class
                getListItemClass: function (item) {
                    return item && item.done ? 'done' : '';
                },
                // æ”¹å˜è¿‡æ»¤æ¡ä»¶
                changeFilter: function (index) {
                    this.filterIndex = index;
                },
                // æ–°å¢ä¸€é¡¹
                addItem: function () {
                    var content = this.content.trim();
                    if (!content.length) {
                        return;
                    }
                    this.infos.push({
                        content: content,
                        done: false
                    });
                    this.content = '';
                },
                // åˆ‡æ¢å®ŒæˆçŠ¶æ€
                toggleDone: function (item) {
                    item.done = !item.done;
                    this.infos = this.infos.slice();
                },
                // åˆ é™¤ä¸€é¡¹
                deleteItem: function (item) {
                    var index = this.infos.indexOf(item);
                    this.infos.splice(index, 1);
                },
                // é‡ç½®æ•°æ®
                reset: function () {
                    Object.assign(this.$data, this.$options.data());
                },
                // ä»localstorageæ›´æ–°æ•°æ®
                restore: function () {
                    try {
                        var content = localStorage['_cache_'];
                        if (!content.length) {
                            return;
                        }
                        var infos = JSON.parse(content);
                        this.infos = infos;
                    }
                    catch (ex) {
                        this.reset();
                    }
                }
            },
            watch: {
                // ç›‘å¬infosæ”¹å˜ï¼Œå­˜å…¥localstorage
                infos: function () {
                    var content = JSON.stringify(this.infos);
                    localStorage['_cache_'] = content;
                }
            }
        });
    </script>
</body>
</html>
